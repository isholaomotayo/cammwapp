(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1890:function(e,t,o){"use strict";o.r(t);o(234);var n=o(134),r=o(3),a=o(821),s=o(47),i=o(538),u=o(1063),c=(o(73),o(72),o(239),o(545)),p=o.n(c),d=o(5),f=o.n(d),l=o(10),m=o.n(l),h=o(1895),v=o(556),b=o(549),y=o(688),w=o(584),C=o(598),g=o(606),O=o(138),_=o(535),T=o(555),j=o(685),U=o(98);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var R=U.a.dispatch,x=U.a.getState,q=function(e){function t(e){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?L(e):t}(this,S(t).call(this,e))).onUserChanged=o.onUserChanged.bind(L(L(o))),o.state={user:w.a.getCurrentUser()};var n=document.getElementById("root");return n&&(n.className+=" channel-view"),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(t,m.a.Component),function(e,t,o){t&&z(e.prototype,t),o&&z(e,o)}(t,[{key:"isValidState",value:function(){return null!=this.state.user}},{key:"onUserChanged",value:function(){var e=w.a.getCurrentUser();_.areObjectsEqual(this.state.user,e)||this.setState({user:e})}},{key:"UNSAFE_componentWillMount",value:function(){g.a.clearLastError()}},{key:"componentDidMount",value:function(){y.b(),this.props.enableTimezone&&this.props.actions.autoUpdateTimezone(Object(j.a)()),p()(window).on("beforeunload",function(){p()(window).off("beforeunload"),document.cookie.indexOf("MMUSERID=")>-1&&Object(v.viewChannel)("",C.a.getCurrentId()||"")(R,x),y.a()}),w.a.addChangeListener(this.onUserChanged),window.addEventListener("focus",this.onFocusListener),window.addEventListener("blur",this.onBlurListener),O.g()?p()("body").addClass("ios"):O.a()&&p()("body").addClass("android"),this.state.user||(p()("#root").attr("class",""),b.p("/login?redirect_to="+encodeURIComponent(this.props.location.pathname),!0,!1)),p()("body").on("mouseenter mouseleave",".post",function(e){"mouseenter"===e.type?(p()(this).prev(".date-separator, .new-separator").addClass("hovered--after"),p()(this).next(".date-separator, .new-separator").addClass("hovered--before")):(p()(this).prev(".date-separator, .new-separator").removeClass("hovered--after"),p()(this).next(".date-separator, .new-separator").removeClass("hovered--before"))}),p()("body").on("mouseenter mouseleave",".search-item__container .post",function(e){"mouseenter"===e.type?(p()(this).closest(".search-item__container").find(".date-separator").addClass("hovered--after"),p()(this).closest(".search-item__container").next("div").find(".date-separator").addClass("hovered--before")):(p()(this).closest(".search-item__container").find(".date-separator").removeClass("hovered--after"),p()(this).closest(".search-item__container").next("div").find(".date-separator").removeClass("hovered--before"))}),p()("body").on("mouseenter mouseleave",".post.post--comment.same--root",function(e){"mouseenter"===e.type?(p()(this).prev(".date-separator, .new-separator").addClass("hovered--comment"),p()(this).next(".date-separator, .new-separator").addClass("hovered--comment")):(p()(this).prev(".date-separator, .new-separator").removeClass("hovered--comment"),p()(this).next(".date-separator, .new-separator").removeClass("hovered--comment"))}),p()(window).on("keydown.preventBackspace",function(e){8!==e.which||p()(e.target).is("input, textarea")||e.preventDefault()})}},{key:"componentWillUnmount",value:function(){y.a(),w.a.removeChangeListener(this.onUserChanged),p()("body").off("click.userpopover"),p()("body").off("mouseenter mouseleave",".post"),p()("body").off("mouseenter mouseleave",".post.post--comment.same--root"),p()(".modal").off("show.bs.modal"),p()(window).off("keydown.preventBackspace"),window.removeEventListener("focus",this.onFocusListener),window.removeEventListener("blur",this.onBlurListener)}},{key:"render",value:function(){if(!this.isValidState())return m.a.createElement(T.a,null);if(this.props.mfaRequired){if("/mfa/setup"!==this.props.location.pathname)return m.a.createElement(h.a,{to:"/mfa/setup"})}else if("/mfa/confirm"===this.props.location.pathname);else if(this.props.showTermsOfService&&"/terms_of_service"!==this.props.location.pathname)return m.a.createElement(h.a,{to:"/terms_of_service?redirect_to="+encodeURIComponent(this.props.location.pathname)});return this.props.children}},{key:"onFocusListener",value:function(){b.a(!0)}},{key:"onBlurListener",value:function(){b.a(!1)}}]),t}();q.propTypes={children:f.a.object,mfaRequired:f.a.bool.isRequired,enableTimezone:f.a.bool.isRequired,actions:f.a.shape({autoUpdateTimezone:f.a.func.isRequired}).isRequired,showTermsOfService:f.a.bool.isRequired};t.default=Object(n.connect)(function(e,t){var o=Object(s.getLicense)(e),n=Object(s.getConfig)(e),r=Object(i.shouldShowTermsOfService)(e);return{mfaRequired:Object(u.a)(o,n,t.match.url),enableTimezone:"true"===n.ExperimentalTimezone,showTermsOfService:r}},function(e){return{actions:Object(r.bindActionCreators)({autoUpdateTimezone:a.autoUpdateTimezone},e)}})(q)},821:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e};t.autoUpdateTimezone=function(e){var t=this;return function(){var o=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,o){return function n(r,a){try{var s=t[r](a),i=s.value}catch(e){return void o(e)}if(!s.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}("next")})}}(regeneratorRuntime.mark(function o(i,u){var c,p,d,f,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:c=(0,r.getCurrentUser)(u()),p=(0,a.getUserTimezone)(u(),c.id),d=p.automaticTimezone!==e,p.useAutomaticTimezone&&d&&(f={useAutomaticTimezone:"true",automaticTimezone:e,manualTimezone:p.manualTimezone},l=n({},c,{timezone:f}),(0,s.updateMe)(l)(i,u));case 4:case"end":return t.stop()}},o,t)}));return function(e,t){return o.apply(this,arguments)}}()};var r=o(538),a=o(684),s=o(551)}}]);
//# sourceMappingURL=8.e720add3aa0d7c0cf4ff.js.map